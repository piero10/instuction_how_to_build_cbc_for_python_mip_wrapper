
Эта инструкция о том как собрать dll [cbc решателя](https://github.com/coin-or/Cbc) для python обертки [python-mip](https://www.python-mip.com/)

## Зачем это нужно
Обертка [python-mip](https://www.python-mip.com/) поставляется с набором dll конкретной версии решателя cbc, если вы хотите использовать альтернативную версию cbc необходимо собрать этот набор библиотек вручную.
Это может быть нужно, в том случае если вы хотите использовать последнюю версию cbc-решателя, а python-mip для нее еще не собран


## Инструкция

### Скачиваем исходники cbc и проекты, от которых он зависит
cbc тут: https://github.com/coin-or/Cbc
но этого мало, этот проект зависит от группы других проектов, все зависимости описаны в config.yaml, из необходимого, это:
- https://github.com/coin-or-tools/Data-Sample
- https://github.com/coin-or-tools/Data-miplib3
- https://github.com/coin-or/CoinUtils
- https://github.com/coin-or/Osi
- https://github.com/coin-or/Clp
- https://github.com/coin-or/Cgl

Все скачиваем, положить их лучше рядом. Далее открываем решение в visual studio, проходим по всем проектам решения. Ссылки на эти проекты в решении есть, но эти ссылки изначально не активны.
*здесь и далее <cbc> - будем обозначать папку в которой лежат дистрибутивы* 

### Закомментировать незалинкованную ф-ию
1. идем в <cbc>/Clp/src/ClpSolver.cpp и комментим вызов a-bb mainTest(): 
в нашем случае это строки 2062, 2063, 2069, 2070, 2094, 2095, 2097, 2098 (*здесь и далее номера строк приведены для cbc версии 2.8.10*)
2. Идем в <cbc>/Clp/src/ClpSolver.hpp и комментим объявление mainTest() (в нашем случае это строки 63, 64, 66, 67)


### Настраиваем проекты
открываем решение в visual studio (<cbc>/MSVisualStudio/v17/Cbc.sln)
переключаем компилятор на "Release"
1. Проект libCoinUtils -> свойства -> 
	Общее -> Тип конфигурации: dll
	c\c++ -> препроцессор -> определения препроцессора: добавить: 
		_WIN32;DLL_EXPORT;_LIB;

*для проверки можно попробовать спересобрать проект libCoinUtils, то же саоме рекомендуем делать после настройки каждого проекта*	
	
2. Проект libOsi -> свойства:
	Общее -> Тип конфигурации: dll
	c\c++ -> препроцессор -> определения препроцессора: добавить: 
		_WIN32;DLL_EXPORT;_LIB;

	Каталоги VC++ -> Каталоги библиотек: Добавить: 
		<cbc>/MSVisualStudio/v17/x64/Release

	*Примечание: Компоновщик появляется после установки типа dll и нажатия кнопки "применить"*
	Компоновщик -> Ввод -> Дополнительные зависимости: добавить 
		libCoinUtils.lib
						
3. Аналогично для проекта libClp. Все один в один как в пункте 2.

4. Аналогично для проекта libOsiClp. Но:
		Компоновщик -> Ввод -> Дополнительные зависимости: добавить: 
			libCoinUtils.lib;libOsi.lib;libClp.lib;

5. Аналогично для проекта libСgl. Но:
		Компоновщик -> Ввод -> Дополнительные зависимости: добавить:
			;libCoinUtils.lib;libOsi.lib;libClp.lib;libOsiClp.lib;

6. Аналогично для проекта libСbc. Но:
		Компоновщик -> Ввод -> Дополнительные зависимости: добавить: 
			;libCoinUtils.lib;libOsi.lib;libClp.lib;libOsiClp.lib;libCgl.lib;

7. Аналогично для проекта libСbcSolver. Но:
		Компоновщик -> Ввод -> Дополнительные зависимости: добавить:
			;libCoinUtils.lib;libOsi.lib;libClp.lib;libOsiClp.lib;libCgl.lib;libCbc.lib;

Итого, для всех перечисленных выше проектов поменяли тип на dll, 
									   добавили директивы препроцессора "_WIN32;DLL_EXPORT;",
									   добавили ";$(CommonExecutablePath);" в каталог библиотек,
									   добавили к каждому проекту (кроме libCoinUtils) свои дополнительные зависимости (перечислены выше).

### Собираем проект libCbcSolver

### Подменяем стандартные dll для Python-miplib3
- создаем переменную окружения: 
PMIP_CBC_LIBRARY = <путь до собранных dll>\libCbcSolver.dll (путь до собранных dll по умолчанию будет равен: <cbc>/MSVisualStudio/v17/x64/Release)
- Запускаем Решение какой-то проблемы c помощью python-mip
- Проверяем версию по приветственной строке в терминале, там должна быть верда дата сборки, пример: 
	*Welcome to the CBC MILP Solver 
	*Version: Trunk
	*Build Date: Dec  8 2022
